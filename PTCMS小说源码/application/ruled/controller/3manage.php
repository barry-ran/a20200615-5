<?php   class manageController extends AdminController{public function keyisok(){$var_2018=C('key_url').'?site='.$_SERVER['SERVER_NAME'].'&token='.C('key_token');$var_2019=@file_get_contents($var_2018);if($var_2019!=$this->keymd5()){return 1;}}public function keymd5(){$var_240=sha1(md5($_SERVER['SERVER_NAME'].C('key_token').'laoniu'));return $var_240;}public function importAction(){if($this->request->isPost()){if(!empty($_FILES[file]['tmp_name'])){$var_2022=unserialize(base64_decode(explode("\n",F($_FILES[file]['tmp_name']))[4]));if($_POST['site']){$var_2023=(new NovelSearch_SiteModel())->add(['name' =>$var_2022['sitename'],'url' =>$var_2022['siteurl'],key =>$var_2022['sitekey'],'isoriginal'=>2]);if(!$var_2023){$this->error('无法添加新站点');}$var_2022['siteid']=$var_2023;}else{$var_2022['siteid']=$_POST['siteid'];}if($_POST['rule']){$var_2022['addnew']=(int) isset($_POST['addnew']);$var_2022['newreplace']=(int) isset($_POST['newreplace']);$var_2022['collectallchapter']=(int) isset($_POST['collectallchapter']);(new RuledModel())->add($var_2022);}else{(new RuledModel())->edit($var_2022,['id' =>$_POST['ruleid']]);}$this->success('导入成功');}else{$this->error('规则文件读取失败');}}else{if($this->keyisok()){echo '授权效验失败,请联系作者,QQ:5988522';exit;}$this->rulelist=$this->model('rule')->field('id,name')->order('id asc')->select();$this->sitelist=$this->model('novelsearch_site')->where(['status' =>1])->field('id,name')->order('id asc')->select();$this->display();}}public function exportAction(){if($this->request->isPost()){$var_180=$this->input->post('ruleid','int',0);if(!$var_180){$this->error('请选择规则');}(new ruledModel())->export($var_180);}else{if($this->keyisok()){echo '授权效验失败,请联系作者,QQ:5988522';exit;}$this->rulelist=$this->model('ruled')->field('id,name')->order('id asc')->select();$this->display();}}}
?>